server {
    listen 80;
    listen [::]:80;

    server_name {{ item.server_name }};

    root {{ item.root }};
    index index.html;

    # Disable directory listing
    autoindex off;

{% if item.basic_auth is defined %}
    # Basic authentication
    auth_basic "{{ item.basic_auth.realm }}";
    auth_basic_user_file /etc/nginx/htpasswd/{{ item.server_name }};
{% endif %}

    location / {
        try_files $uri $uri/ =404;
    }

    # Logging
    access_log /var/log/nginx/{{ item.server_name }}_access.log;
    error_log /var/log/nginx/{{ item.server_name }}_error.log;
}
