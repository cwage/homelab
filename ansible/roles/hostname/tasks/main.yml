---
# Minimal hostname configuration for VMs
# Requires: domain_name variable
# Uses: hostname_override if set, otherwise inventory_hostname_short

- name: Set hostname variable
  ansible.builtin.set_fact:
    target_hostname: "{{ hostname_override | default(inventory_hostname_short) }}"

- name: Set system hostname
  ansible.builtin.hostname:
    name: "{{ target_hostname }}.{{ domain_name }}"
  when: domain_name is defined

- name: Update /etc/hosts with hostname
  ansible.builtin.lineinfile:
    path: /etc/hosts
    regexp: '^127\.0\.1\.1\s+'
    line: "127.0.1.1\t{{ target_hostname }}.{{ domain_name }} {{ target_hostname }}"
    state: present
  when: domain_name is defined
