services:
  backup:
    build:
      context: .
      dockerfile: Dockerfile
    user: "${UID:-1000}:${GID:-1000}"
    env_file:
      - path: ../.env
        required: false
      - path: .env
        required: false
    volumes:
      # NAS shares (read-only for backup)
      - /mnt/nas:/mnt/nas:ro,rslave
      # USB drive (read-write for local backup)
      - /media/${USER:-cwage}/nasbak:/backup/local
      # Logs
      - ./logs:/var/log/backup
      # Target configs
      - ./targets:/opt/backup/targets:ro
      # Scripts (live mount for iteration)
      - ./scripts:/opt/backup/scripts:ro
    working_dir: /opt/backup
